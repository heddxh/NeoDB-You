## OpenAPI Document Location

The OpenAPI document is available at [https://neodb.social/api/docs](https://neodb.social/api/docs).
It is generated by `django-ninja`.

## Do I need `org.jetbrains.kotlinx:kotlinx-coroutines-android`?

No. Although
the [Android developer documentation](https://developer.android.com/kotlin/coroutines#dependency)
suggests adding this dependency, it is already included as a transitive dependency in the library.  
See: [Stack Overflow Answer](https://stackoverflow.com/a/74861174/22591462)

## Why is the top-level `build.gradle.kts` empty?

Since this is a single-module project, all plugins and dependencies are declared in the `:app`
module.

## About `Modifier`

In my composable functions, `Modifier` should be the last parameter and passed to the first child
that emits UI (e.g., `Row`, `Text`, etc.).

### Why isn't the latter `Modifier.fillMaxSize` working?

In layouts like `Row`, where child composables are measured from left to right, if an earlier
composable already uses `Modifier.fillMaxSize`, subsequent composables won't receive any remaining
space.

### Performance of `Modifier.clickable`

Instead using `Modifier.clickable {}`, using the other overload to skip unnecessary recomposition:

```kotlin
Modifier.clickable(
    interactionSource = null,
    indication = LocalIndication.current,
    onClick = onClick,
)
```

See: https://issuetracker.google.com/issues/241154852 and the comment of the source code.

## Ktor logging

Add dependencies:

```toml
slf4j-android = { group = "org.slf4j", name = "slf4j-android", version.ref = "slf4jAndroid" }
ktor-client-logging = { group = "io.ktor", name = "ktor-client-logging", version.ref = "ktor" }
```

Then change logger:

```kotlin
val ktorfit = ktorfit {
    httpClient(HttpClient {
        install(Logging) {
            logger = Logger.ANDROID // <<< DEFAULT is nor working
            level = LogLevel.ALL
        }
    })
}
```

## `MutableStateFlow` vs `MutableState`

If you don't familiar with Kotlin flow, here is the key point:

`MutableStateFlow` is from Kotlin coroutines, which is a class from language official library. But
`MutableState` is a concept from Compose framework, basically the state in Compose is built on this.

So, since it is recommended to avoid reference UI staff in ViewModel, using `MutableStateFlow` as
public UiState in ViewModel is preferred.

See
also: https://developer.android.com/develop/ui/compose/state?hl=en#use-other-types-of-state-in-jetpack-compose

## Some words about OAUTH2 authentication on Android

- Standard Android implementation: [AppAuth-Android](https://github.com/openid/AppAuth-Android)
- A community KMP
  implementation: [kotlin-multiplatform-oidc](https://github.com/kalinjul/kotlin-multiplatform-oidc)

NeoDB/Mastodon has its quirk:

> At present, Mastodon does not support the Dynamic Client Registration protocol,
> however it does support a proprietary endpoint for registering an OAuth Application.
>
> At present Mastodon only supports confidential clients,
> however work is underway to add support for public clients.

See:

- https://docs.joinmastodon.org/spec/oauth/
- https://neodb.net/api/#how-to-authorize

So we should store client_secret in our end.

But
Android's [EncryptedSharedPreferences](https://developer.android.com/reference/androidx/security/crypto/EncryptedSharedPreferences)
is [deprecated](https://cs.android.com/androidx/platform/frameworks/support/+/androidx-main:security/security-crypto/src/main/java/androidx/security/crypto/EncryptedSharedPreferences.java;drc=83d0df9197c5320ac2e10d92afaf9ee839cec144;l=81),
and also both this and [KeyStore](https://developer.android.com/privacy-and-security/keystore)
is [not reliable](https://github.com/tink-crypto/tink/issues/535#issuecomment-912170221).

Besides, as the official alternative
to [SharedPreferences](https://developer.android.com/reference/android/content/SharedPreferences),
[DataStore](https://developer.android.com/topic/libraries/architecture/datastore) is recommended but
have no encryption function.
Although we have a community
library: [encrypted-datastore](https://github.com/osipxd/encrypted-datastore), it is preferred to
wait Google to achieve it officially.
Here is the [bug report](https://issuetracker.google.com/issues/167697691), 792 votes without any
response from Google.
